[目次](../目次.md) > [データ定義 目次](目次.md) > スキーマ設計方針
# スキーマ設計方針

**対象範囲**: 認証・登録・セッション・MFA・監査・レート制限・ブロックリスト

### 共通設計
- **Keyspace**: `sansa_auth`
- **Consistency**: 読み取り `LOCAL_QUORUM`、書き込み `LOCAL_QUORUM` を推奨（RF=3 時）
- **時間属性**
  - 作成/更新時刻に **マイクロ秒精度の epoch** または **`timestamp`** を使用（監査は時間での範囲取得が多いため）
- **TTL 方針**
  - 短命データ（メール認証コード、レート制限カウンタ、RefreshToken、MFA一時切替フラグ）は TTL を設定
- **検索要件**
  - Cassandra は PK 以外の ad-hoc 検索が不得手 → 需要が高い検索は**別テーブル**または**マテリアライズドビュー**で対応

### 主なアクセスパターンとテーブル
- `users`：`user_id` / `account_id` / `email` で検索 → `users_by_account`, `users_by_email`
- `sessions`：`session_id` / `user_id + device_id` で削除・列挙
- `email_verifications`：`challenge_id` で検証、TTL
- `mfa_*`：TOTP シークレットと状態、メールコードの一時切替
- `auth_audit`：ユーザー別・時間範囲取得
- `rate_limits`：`bucket + key + windowStart` でインクリメント、TTL

---
[目次](../目次.md) > [データ定義 目次](目次.md) > スキーマ設計方針
