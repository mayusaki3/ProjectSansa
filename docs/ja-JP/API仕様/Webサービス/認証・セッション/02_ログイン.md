[目次](../../../目次.md) > API仕様 > Webサービス> [認証・セッション 目次](目次.md) > ログイン
# ログイン（Passkey/WebAuthn + リスクベースMFA）

## 目的
ID+パスワードを不要化し、**パスキー(WebAuthn)** を主要手段とする。高リスク時や一定経過時は **MFA** を要求。

## フロー
1. `GET /webauthn/challenge`
2. 端末内のパスキーで署名 → `POST /webauthn/assertion`
3. ポリシー判定: `MFA_MAX_AGE` 超過、新規端末/環境などなら `401 mfa_required`
4. `POST /auth/mfa/totp/verify` または `POST /auth/mfa/email/verify` で完了
5. `accessToken` と `refreshToken` を発行

## エンドポイント
- `GET /webauthn/challenge` → `{ challenge, rpId, timeout, userVerification }`
- `POST /webauthn/assertion` → 200 / 401(`mfa_required { factors, challengeId }`)
- `POST /auth/mfa/totp/verify`
- `POST /auth/mfa/email/request` / `POST /auth/mfa/email/verify`

## ポリシー
- `MFA_MAX_AGE=30d`（既定）を超えるとMFA要求
- 新規 `deviceId` / 国外IP / UA大変化はMFA要求（メールOTPは高リスク時は除外可）

## セッション
- 複数端末ログイン可
- 一斉ログアウト: `POST /auth/logout_all`（`token_version++`）

## エラー例
- `mfa_required`, `invalid_assertion`, `rate_limited`, `locked`

## 参照
- [WebAuthn（パスキー）](./WebAuthn.md)
- [MFA（TOTP/メールOTP）](./MFA.md)
- [セッション管理](./セッション管理.md)

---
[目次](../../../目次.md) > API仕様 > Webサービス> [認証・セッション 目次](目次.md) > ログイン